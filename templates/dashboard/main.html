{% extends "standard_page.html" %}

{% block page_name %}Dashboard Principal{% endblock %}
{% block page_header %}AcidTech Cash Flow Dashboard{% endblock %}
{% block page_description %}Executive overview of financial operations for AcidTech Services{% endblock %}
{% block header_icon %}fas fa-home{% endblock %}
{% block header_icon_large %}fas fa-home{% endblock %}

{% block kpi1_label %}Total Inflows{% endblock %}
{% block kpi1_value %}<span id="total-inflows">$0</span>{% endblock %}
{% block kpi1_color %}border-primary{% endblock %}
{% block kpi1_text_color %}text-primary{% endblock %}
{% block kpi1_icon %}fas fa-coins{% endblock %}

{% block kpi2_label %}Total Outflows{% endblock %}
{% block kpi2_value %}<span id="total-outflows">$0</span>{% endblock %}
{% block kpi2_color %}border-success{% endblock %}
{% block kpi2_text_color %}text-success{% endblock %}
{% block kpi2_icon %}fas fa-arrow-trend-up{% endblock %}

{% block kpi3_label %}Net Flow{% endblock %}
{% block kpi3_value %}<span id="net-flow">$0</span>{% endblock %}
{% block kpi3_color %}border-info{% endblock %}
{% block kpi3_text_color %}text-info{% endblock %}
{% block kpi3_icon %}fas fa-list{% endblock %}

{% block kpi4_label %}Transactions{% endblock %}
{% block kpi4_value %}<span id="transaction-count">0</span>{% endblock %}
{% block kpi4_color %}border-warning{% endblock %}
{% block kpi4_text_color %}text-warning{% endblock %}
{% block kpi4_icon %}fas fa-percentage{% endblock %}

{% block main_content_title %}Recent Activity{% endblock %}
{% block main_content_body %}
<div class="alert alert-info" role="alert">
  <i class="fas fa-info-circle me-2"></i>
  <strong>System Status:</strong> All financial systems operational. 594 transactions processed and classified.
</div>

<!-- Recent Transactions Table -->
<div class="table-responsive">
  <table class="table table-hover">
    <thead class="table-light">
      <tr>
        <th>Date</th>
        <th>Account</th>
        <th>Description</th>
        <th class="text-end">Amount</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody id="recent-transactions-body"></tbody>
  </table>
</div>

<div class="text-center mt-3">
  <a href="{{ url_for('cash_flow.index') }}" class="btn btn-primary">
    <i class="fas fa-eye me-2"></i>
    View All Transactions
  </a>
</div>
{% endblock %}

{% block quick_actions %}
<div class="d-grid gap-2">
  <a href="{{ url_for('cash_flow.enhanced_dashboard') }}" class="btn btn-primary">
    <i class="fas fa-chart-line me-2"></i>
    Enhanced Dashboard
  </a>
  <a href="{{ url_for('main.financial_summary') }}" class="btn btn-outline-info">
    <i class="fas fa-bullseye me-2"></i>
    Financial Summary
  </a>
  <a href="{{ url_for('cash_flow.classification_dashboard') }}" class="btn btn-outline-warning">
    <i class="fas fa-robot me-2"></i>
    Classification Review
  </a>
  <a href="{{ url_for('reports.index') }}" class="btn btn-outline-secondary">
    <i class="fas fa-chart-bar me-2"></i>
    Generate Reports
  </a>
</div>
{% endblock %}

{% block info_panel_title %}System Health{% endblock %}
{% block info_panel_content %}
<div class="list-group list-group-flush">
  <div class="list-group-item d-flex justify-content-between align-items-center">
    <div>
      <strong>Database Status</strong>
      <br><small class="text-muted">SQLite Connection</small>
    </div>
    <span class="badge bg-success rounded-pill">Connected</span>
  </div>
  <div class="list-group-item d-flex justify-content-between align-items-center">
    <div>
      <strong>Classification Engine</strong>
      <br><small class="text-muted">AI Processing</small>
    </div>
    <span class="badge bg-success rounded-pill">Active</span>
  </div>
  <div class="list-group-item d-flex justify-content-between align-items-center">
    <div>
      <strong>Data Integrity</strong>
      <br><small class="text-muted">Transaction Validation</small>
    </div>
    <span class="badge bg-success rounded-pill">100%</span>
  </div>
  <div class="list-group-item d-flex justify-content-between align-items-center">
    <div>
      <strong>System Uptime</strong>
      <br><small class="text-muted">Service Availability</small>
    </div>
    <span class="badge bg-primary rounded-pill">24/7</span>
  </div>
</div>
{% endblock %}

{% block context_title %}Financial Performance{% endblock %}
{% block context_description %}
Current financial metrics demonstrate strong operational performance with 
$14.6M revenue YTD and excellent profit margins, positioning AcidTech 
well for continued growth in the competitive Permian Basin market.
{% endblock %}

{% block page_scripts %}
// Refresh dashboard data every 30 seconds
setInterval(function() {
    fetch('/dashboard/api/summary')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                const fmt = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' });
                document.getElementById('total-inflows').textContent = fmt.format(data.total_inflows);
                document.getElementById('total-outflows').textContent = fmt.format(data.total_outflows);
                document.getElementById('net-flow').textContent = fmt.format(data.net_flow);
                document.getElementById('transaction-count').textContent = data.transaction_count;
            }
        })
        .catch(error => console.log('Dashboard refresh error:', error));
}, 30000);
{% endblock %}